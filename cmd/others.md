- [1. scpコマンド](#1-scpコマンド)
  - [1.1. オプション](#11-オプション)
  - [1.2. パス](#12-パス)
- [2. 実行権限について](#2-実行権限について)
  - [2.1. 確認: ll, ls -l](#21-確認-ll-ls--l)
  - [2.2. アクセス権限の変更: chmod](#22-アクセス権限の変更-chmod)
  - [2.3. 数値で指定](#23-数値で指定)
  - [2.4. アルファベットで指定](#24-アルファベットで指定)
  - [2.5. オプション](#25-オプション)
- [3. ファイル削除（linux）: rm](#3-ファイル削除linux-rm)
  - [3.1. オプション](#31-オプション)
- [4. ファイルの文字列検索: find, grep](#4-ファイルの文字列検索-find-grep)
  - [4.1. and, or 検索](#41-and-or-検索)
  - [4.2. オプション](#42-オプション)
- [5. カレントディレクトリのパス確認：pwd](#5-カレントディレクトリのパス確認pwd)
- [6. メモリなどの状況を確認：vmstat](#6-メモリなどの状況を確認vmstat)
  - [6.1. オプション](#61-オプション)
  - [6.2. 見方](#62-見方)
  - [6.3. その他使い方](#63-その他使い方)
- [7. 実行中のプロセスの状態を取得：top](#7-実行中のプロセスの状態を取得top)
  - [7.1. オプション](#71-オプション)
  - [7.2. 操作](#72-操作)
  - [7.3. ヘッダーの見方](#73-ヘッダーの見方)
  - [7.4. プロセス一覧](#74-プロセス一覧)
  - [7.5. ファイルに出力](#75-ファイルに出力)
- [8. 公開鍵・秘密鍵の作成：ssh-keygen](#8-公開鍵秘密鍵の作成ssh-keygen)
# 1. scpコマンド
以下のコマンドを使用することで、ローカルから他サーバーに、もしくは逆パターンでファイルなどを転送できる。
```
$ scp [オプション] コピー元パス 保存先パス
```
## 1.1. オプション
|オプション|説明|
|:--|:--|
|-i 鍵ファイル|ssh接続に使用する鍵ファイルを指定する|
|-P ポート番号|(sshのポートを変更している場合などに)接続に使用するポートを指定する|
|-p|コピー元のタイムスタンプやパーミッションを保持する|
|-r|ディレクトリごとに再帰的にコピーする|

## 1.2. パス
パスは以下のような構成で記述する。
```
ユーザ名@サーバのホスト名(or IPアドレス):コピーしたいファイル、もしくは保存先のパス
```
ローカルの場合は`ユーザ名@サーバのホスト名(or IPアドレス):`を省略できる。

* リモートのファイル（test.txt）をローカルのカレントディレクトリへコピー
```
$ scp user@xxx.xxx.xxx.xxx:~/test.txt ./
```

* ローカルのカレントディレクトリのファイル（test.txt）をリモートのホームディレクトリ直下へコピー
```
$ scp test.txt user@xxx.xxx.xxx.xxx:~/
```

# 2. 実行権限について
以下はlinux環境でのもの
## 2.1. 確認: ll, ls -l

カレントディレクトリ内のファイルやディレクトリの情報を確認する。
```bash
$ ll
```
または
```bash
$ ls -l
```
上記コマンドを実行すると、以下のように表示
```bash
-rw-r--r--  1 user group  90  3月 16 11:50 test.txt
drwxr-xr-x  2 user group 253  3月 16 11:50 downloads
```

`-rw-r--r--`や`drwxr-xr-x`はファイルの情報を示す。
最初の1文字目はファイルの種類を以下のように示す。
|種別|意味|
|:--|:--|
|-|ファイル|
|d|ディレクトリ|
|l|シンボリックリンク|

それ以降は3文字区切りで順にファイルの所有者、所有グループ、その他に関する権限を示す。その文字が表示されていたら該当する権限があり、「-」だった場合は権限がない。
また文字それぞれの意味は以下の通り。
|文字|意味|
|:--|:--|
|r|読み取り|
|w|書き込み|
|x|実行|

## 2.2. アクセス権限の変更: chmod
変更には`chmod`コマンドを使う。指定方法には数字とアルファベットがある。
## 2.3. 数値で指定
以下はhoge.txtに対してパーミッションの確認→変更→確認を行っている。
```bash
$ ls -l　
-rw-r--r--  1 user group      9  1月 1 00:00 hoge.txt
$ chmod 764 hoge.txt
$ ls -l
-rwxrw-r--  1 user group      9  1月 1 00:00 hoge.txt
```
chmodのコマンドは数字で指定する場合以下のように実行する。
```bash
chmod モード 対象ファイル名
```
モードの数字は以下の通り
|モード（数字）|モード（アルファベット）|権限|
|:--|:--|:--|
|4|r|読み取り|
|2|w|書き込み|
|1|x|実行|

上記の合計値を「所有者」「所有グループ」「その他」の順で入力
例えば「764」の場合、それぞれ「読み取り」「書き込み」「実行」、「読み取り」「書き込み」、「読み取り」を付与している
組み合わせとしては以下のようになる
|合計値|読み取り|書き込み|実行|
|:--:|:--:|:--:|:--:|
|1|×|×|〇|
|2|×|〇|×|
|3|×|〇|〇|
|4|〇|×|×|
|5|〇|×|〇|
|6|〇|〇|×|
|7|〇|〇|〇|

## 2.4. アルファベットで指定
以下はhoge.txtに対して所有者、所有グループ、その他にそれぞれ「実行」、「書き込み」を追加している。（最初と最後は数字のものと同じ)
```bash
$ ls -l
-rw-r--r--  1 user group      9  1月 1 00:00 hoge.txt
$ chmod u+x hoge.txt
$ ls -l
-rwxr--r--  1 user group      9  1月 1 00:00 hoge.txt
$ chmod g+w hoge.txt
$ ls -l
-rwxrw-r--  1 user group      9  1月 1 00:00 hoge.txt
```
アルファベットで変更するときは以下のようにコマンドを実行
```bash
chmod (変更対象)(変更方法)(変更内容) 対象ファイル
```
以下を例にする
```bash
$ chmod u+x hoge.txt
```
uが変更対象、+が変更方法、xが変更内容
変更対象については以下のようになる
|変更対象|意味|
|:--|:--|
|u|ユーザー|
|g|グループ|
|o|その他|
|a|すべて|
変更方法については以下のようになる
|変更方法|意味|
|=|指定した権限にする|
|+|指定した権限を付与（追加）する|
|-|指定した権限を除去する|
よって先の例は「ユーザーに実行権限を付与」となる。
以下のように複数指定もできる。
```bash
$ chmod go+w hoge.txt
$ chmod a-wx hoge.txt
```
## 2.5. オプション
オプションを指定する際は以下のように実行
```bash
$ chmod [option] [mode] [file or directory]
```
chmodコマンドのオプションは以下のようになっている。
|オプション|意味|
|:--|:--|
|-f|エラーメッセージを表示しない|
|-c|実行時に変更があったときのみ結果を表示|
|-v|詳細を表示|
|-R|ディレクトリ内の複数ファイルを対象に|

# 3. ファイル削除（linux）: rm
`rm`コマンドでファイル、ディレクトリを削除する。
その際ファイル、ディレクトリは複数指定できる
以下書式
```cmd
$ rm [option] file1 file2 file3 ...
$ rm [option] dir1 dir2 dir3 ...
```

## 3.1. オプション
|短いオプション|長いオプション|意味|
|:--|:--|:--|
|-f|--force|存在しないファイルを無視する（確認もしない）|
|-i|--interactive|削除前に確認する|
|-v|--verbose|経過を表示する|
|-d|--directory|unlinkでディレクトリを削除する|
|-r, -R|--recursive|ディレクトリを再帰的に削除する|

# 4. ファイルの文字列検索: find, grep
windowsでは`find`、macやlinuxでは`grep`コマンドで検索する
* grep
```cmd
$ grap 検索正規表現 ファイル名
```
例) workディレクトリ内のファイルすべての中からaという文字列を検索
```cmd
$ grep a work/*
```

## 4.1. and, or 検索
* and検索
  二つの条件両方に当てはまる行を表示する。基本的にはパイプで二つのコマンドをつなぐ
  ```cmd
  $ grep 検索文字列1 ファイル名 | grep 検索文字列2
  ```
  1文の中でのand検索は、以下のように正規表現を使う
  ```cmd
  $ grep スタートの検索文字列.*尾張の検索文字列 ファイル名
  ```
  例) workディレクトリ内のファイルすべての中からrで始まってpで終わる部分のある行
  ```cmd
  $ grep r.*p work/*
  ```
* or検索
  オプションで拡張正規表現を用いて|のor演算子を使う
  ```cmd
  $ grep -E 検索正規表現 ファイル名
  ```
  例) workディレクトリ内のファイルすべての中から大文字のpまたはeのいずれかを検索
  ```cmd
  $ grep -E 'p|e' work/*
  ```
  もしくはeオプションを使う
  ```cmd
  $ grep -e 検索正規表現1 -e 検索正規表現2 ファイル名
  ```
  例) workディレクトリ内のファイルすべての中から小文字のpまたはaのいずれかを検索
  ```cmd
  $ grep -e p -e a work/*
  ```
## 4.2. オプション
|オプション名|意味|
|:--|:--|
|-i|大文字と小文字を区別しない|
|-E|拡張正規表現を使う|
|-e|一致処理に指定した正規表現を使う|
|-v|一致しないものを検索|
|-n|検索結果に行番号を表示|
|-l|検索結果にファイル名のみ表示|
|-h|検索結果にファイル名を表示しない|
|-o|検索結果に一致した文字を表示|
|-C|検索結果に一致した個所から前後に指定した行数表示|
|-r|ディレクトリ内も検索対象とする|

# 5. カレントディレクトリのパス確認：pwd
`pwd`コマンドで確認できる
```cmd
$ pwd
/home/hoge/now_dir
```

# 6. メモリなどの状況を確認：vmstat
参考：[vmstatコマンドの使い方 - hana_shinのLinux技術ブログ](https://hana-shin.hatenablog.com/entry/2022/02/03/073240)
以下の状態を確認できる
* プロセスの状態
* メモリの使用状況
* スワッピングの状況
* ブロックI/Oの状況
* 割り込みやコンテキストスイッチの回数
* CPUの使用状況（ユーザーモード、カーネルモード等の使用割合）

## 6.1. オプション
|短いオプション|長いオプション|意味|
|:--|:--|:--|
|-a|--active|アクティブ/非アクティブなメモリの量を表示する|
|-d|--disk|ディスクの統計情報を表示|
|-D|--disk-sum|ディスクの統計情報を1項目1行で表示する|
|-f|--forks|ブート後のフォーク数を表示|
|-m|--slabs|スラブ情報を表示（root）|
|-n|--one-header|繰り返し表示の際にヘッダを１度だけ表示|
|-p パーティション|--partition パーティション|指定したパーティションの統計を表示する|
|-s|--stats|1項目1行でメモリの統計情報とイベントカウンタを表示|
|-S 単位|--unit 単位|単位をk,K,m,Mで指定|
|-t|--timestamp|タイムスタンプを表示（オプションなし、「-a」「-d」のみ）|
|-w|--wide|表示幅を広くして見やすくする|

## 6.2. 見方
`vmstat`コマンドを使用すると以下のように表示される。
```cmd
$ vmstat
procs -----------memory------------  --swap-- -----io---- --system-- ------cpu-----
 r  b    swpd   free   buff   cache   si   so    bi    bo    in   cs us sy id wa st
 4  0 1821184 616660     24  815716    1    9    63    25    38   76  3  3 94  0  0
```
それぞれの項目は以下の通り。
このとき、CPUでは総時間を100%として5種類それぞれに使用した時間をパーセンテージで表示している。
|欄|記号|意味|
|:--|:--|:--|
|procs|r|実行中と実行待ち中のプロセス数の合計|
|^|b|割り込み不可能なスリープ状態にあるプロセス数|
|memory|swpd|使用仲の仮想メモリの量|
|^|free|空きメモリの量|
|^|buff|バッファとして使用しているメモリの量|
|^|cache|キャッシュに使用しているメモリの量|
|^|inact|アクティブでないメモリの量|
|^|active|アクティブなメモリの量|
|swap|si|ディスクからスワップインしているメモリの量|
|^|so|スワップアウトしている量|
|io|bi|HDDのようなブロック型デバイスから受け取ったブロックス|
|^|bo|ブロック型デバイスに送ったブロック数|
|system|in|1秒当たりの割り込み回数|
|^|cs|コンテクストスイッチの回数|
|cpu|us|ユーザー空間のプログラムの実行に費やしたCPUの実行時間の割合|
|^|sy|カーネル空間のプログラムの実行に費やしたCPUの実行時間の割合|
|^|id|アイドル状態の時間の割合|
|^|wa|I/O待ち時間|
|^|st|仮想マシンがCPUを割り当てられなかった時間の割合|

## 6.3. その他使い方
1. 時間ごとに実行
  `$ vmstat {interval}`で`interval`秒ごとに実行する
  以下は１秒ごとに実行（わかりやすいようにタイムスタンプを表示している)
    ```cmd
    $ vmstat -t 1
    procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----  -----timestamp-----
    r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa  st                 JST
    3  0 1814784 530728     24 883448    1    9    63    25   38   75  3  3 94  0  0  2022-07-25 13:48:06
    1  0 1814784 529884     24 883448    0    0    24     0  497  816  2  3 95  0  0  2022-07-25 13:48:07
    1  0 1814784 529224     24 883492    0    0    20     0  494  742  6  6 88  0  0  2022-07-25 13:48:08
    ```
2. 実行回数を指定する
  `$ vmstat {interval} {time}`で`interval`秒ごとに`time`回実行する

# 7. 実行中のプロセスの状態を取得：top
topコマンドを使用することで、システム全体の負荷やプロセス、CPU、メモリ、スワップの統計情報をリアルタイムで取得できる。

## 7.1. オプション
主なオプションは以下の通り
|オプション|意味|
|-a|メモリ使用率順にソート|
|-p PID|特定のプロセスを監視|
|-d {iterval}|`interval`秒ごとに更新|
|-n {time}|`time`回表示を繰り返す|

## 7.2. 操作
* Shift + o
  表示された特定のキーを押してEnterすると任意の列でソート
* Shift + p
  CPU使用率順にソート
* Shift + m
  メモリ使用率順にソート
## 7.3. ヘッダーの見方
1. load average
    ```cmd
    top - 14:16:41 up 5 days, 4 min,  1 user,  load average: 0.37, 0.49, 0.47
          現在時間  サーバーの稼働時間  ログイン                1分   5分    15分
                                    ユーザー数  間の単位時間当たりの待ちタスク数
    ```
2. Task
    ```cmd
    Tasks: 307 total,   1 running, 306 sleeping,   0 stopped,   0 zombie
          合計タスク数      稼働中      待機中        停止タスク   ゾンビタスク
    ```
3. CPU
  * ni
    `nice`で実行優先度を変更したプロセスがユーザーモードでCPUを消費した時間
  * st
    OS仮想化利用時に他の仮想CPUの計算で待たされた時間
    ```
    %Cpu(s):  3.1 us,  3.8 sy,  0.0 ni, 93.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
              user     system    nice    idle    I/O wait hardware software  steal
                                                        interrupt interrupt
    ```
4. Merory/swap
  * buffers
    mallocなどバッファとして利用されているメモリ量
  * cached
    キャッシュとして利用されているメモリ量（ファイルシステムのキャッシュ）
    ```cmd
    Mem:  15144564k total,  1178112k used, 13966452k free,    28300k buffers
    Swap:        0k total,        0k used,        0k free,   289928k cached
    ```
## 7.4. プロセス一覧
```
PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                                                                        
11678 kyosuke+  20   0 4390288   1.6g  12492 S  0.3 20.7  17:29.19 java                                                                                                                           
17071 kyosuke+  20   0 2014648 665564   7904 S  0.0  8.3   1:19.66 node                                                                                                                           
 3695 kyosuke+  20   0 2679168 482728   5324 S  0.0  6.0  15:54.19 java                                                                                                                           
16914 kyosuke+  20   0   11.0g 258044  11160 S  0.0  3.2   5:36.18 node                                                                                                                           
 5346 kyosuke+  20   0 2629108 239732   5240 S  0.3  3.0  26:08.14 java                                                                                                                           
12498 kyosuke+  20   0  507600 235680   3632 S  0.0  2.9   1:43.00 python  
```
|PR|NI|VIRT|RES|SHR|S|%CPU|%MEM|TIME+|
|:--|:--|:--|:--|:--|:--|:--|:--|:--|
|優先度|相対優先度|仮想メモリ|物理メモリ|共有メモリ|状態|CPU使用率|メモリ使用率|実行時間|
* NI: Nice value
  相対優先度。0が基準で、負だと優先度が高く、正だと優先度が低い
* VIRT: Virtual Image
  確保された仮想メモリすべて。スワップしたメモリ使用量を含む
* RES: Resident size
  スワップしていない、使用した物理メモリのサイズ
* SHR: Shared Mem size
  他のプロセスと共有される可能性のあるメモリのサイズ
* S: Process Status
  以下のいずれかの状態であるかを示す。
  * D: 割り込み不能
  * R: 実行中
  * S: スリープ状態
  * T: 停止中
  * Z: ゾンビプロセス
## 7.5. ファイルに出力
`-b`オプションを使用することでファイルに書き出しができる
```
$ top -b > result.txt
```
`ctrl + c`などで停止するまで実行される
`-d`オプションを使用して間隔を設定したり、`-n`オプションで回数を指定することもできる

# 8. 公開鍵・秘密鍵の作成：ssh-keygen
`ssh-keygen`コマンドで作成できる
```cmd
$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/Users/ユーザー名/.ssh/id_rsa): <--鍵の保存先 
Enter passphrase (empty for no passphrase):  <-- パスフレーズを入力（任意）
Enter same passphrase again:  <-- もう一度、パスフレーズを入力（任意）
Your identification has been saved in id_rsa.
Your public key has been saved in id_rsa.pub.
```
設定で何も入力せずにEnterを押下するとデフォルトで作成される。
結果、`id_rsa`と`id_rsa.pub`が作成される。
それぞれ、`id_rsa`が**秘密鍵**、`id_rsa.pub`が**公開鍵**となる。